#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: pkrtemplate-latest
    username: packer
    # the below password is 'packer' crated by: mkpasswd --method=SHA-512
    password: "$6$s8svyqmmVPmqf.C2$0QSq3Pm1SWz8JHJeL.Bqicy2lbkAOMvrppINATeZMzEPRn5FrJWO5uIBAv3zcf675Zr.FhPWwts8f6auAEqut1"
  users:
    - name: packer
      sudo: ALL=(ALL) NOPASSWD:ALL
      groups: users,adm,sudo,cdrom
  storage:
    layout:
      name: lvm
      sizing-policy: all
  ssh:
    install-server: true
    allow-pw: true
  keyboard:
    layout: us
    variant: ''
  # This late command is because we disable the network during boot
  # Change ens160 to whatever your interface id is
  late-commands:
    - |
      chroot /target
      mkdir -p /etc/netplan/
      cat <<EOF > /target/etc/netplan/01-installer-config.yaml
      network:
        ethernets:
          ens160:
            dhcp4: yes
        version: 2
      EOF
      netplan apply