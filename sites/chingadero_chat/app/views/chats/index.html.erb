<div class="max-w-3xl mx-auto h-[85vh] mt-8 bg-white rounded-2xl shadow-xl flex flex-col overflow-hidden border border-gray-100">
  
  <!-- Header -->
  <header class="bg-white px-6 py-4 border-b border-gray-200 flex items-center gap-3">
    <div class="bg-gradient-to-br from-purple-500 to-blue-500 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-sm">
      ✨
    </div>
    <h2 class="m-0 text-xl font-semibold text-gray-800">Gemini AI</h2>
  </header>

  <!-- Chat History -->
  <div class="flex-grow p-6 overflow-y-auto bg-gray-50 flex flex-col gap-5" id="chat-messages">
    <% if @messages.empty? %>
      <div class="text-center text-gray-400 mt-10">
        <p>Send a message to start the conversation!</p>
      </div>
    <% end %>

    <% @messages.each do |msg| %>
      <div class="flex items-end gap-2 w-full <%= msg.role == 'user' ? 'justify-end' : 'justify-start' %>">
        
        <% if msg.role == 'model' %>
          <div class="bg-gradient-to-br from-purple-500 to-blue-500 text-white w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 text-sm shadow-sm">✨</div>
        <% end %>

        <div class="max-w-[80%] px-4 py-3 text-[15px] leading-relaxed <%= msg.role == 'user' ? 'bg-blue-600 text-white rounded-2xl rounded-br-sm shadow-md' : 'bg-white text-gray-800 rounded-2xl rounded-bl-sm border border-gray-200 shadow-sm' %>">
          <%= simple_format(msg.content, class: "mb-0 [&>p]:mb-2[&>p:last-child]:mb-0") %>
        </div>

      </div>
    <% end %>
  </div>

  <!-- Input Form -->
  <div class="p-4 bg-white border-t border-gray-200">
    <%= form_with url: chats_path, local: true, class: "flex gap-2 bg-gray-50 border border-gray-300 rounded-full p-1.5 focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-all" do |f| %>
      
      <%= f.text_field :content, 
                       placeholder: "Message Gemini...", 
                       class: "flex-grow bg-transparent border-none focus:ring-0 text-gray-800 px-4 py-2 outline-none", 
                       required: true, 
                       autocomplete: 'off',
                       autofocus: true %>
      
      <%= button_tag type: 'submit', class: "bg-blue-600 hover:bg-blue-700 text-white rounded-full w-10 h-10 flex items-center justify-center transition-colors flex-shrink-0" do %>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 ml-1">
          <path d="M3.478 2.404a.75.75 0 00-.926.941l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.404z" />
        </svg>
      <% end %>
    <% end %>
  </div>
</div>

<!-- Auto-Scroll JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const chatMessages = document.getElementById("chat-messages");
    if (chatMessages) {
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  });
</script>
